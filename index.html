<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Periodic Table — Sphere UI (Double-Sided)</title>
<style>
  :root{--teal:#00f0f0;--dark:#001010;}
  html,body{height:100%;margin:0;background:#000; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
  body{font-family: "Inter", "Helvetica Neue", Arial, sans-serif; color:var(--teal); overflow:hidden; position:relative;}
  
  .top-wrapper{position:absolute;top:0; left:0; right:0; z-index:40; background:linear-gradient(#d9d9d9,#d9d9d9); height:64px; display:flex; align-items:center; padding:0 18px; box-sizing:border-box; border-bottom: 1px solid rgba(0,0,0,0.06);}
  .back { width:44px; height:44px; display:flex; align-items:center; justify-content:center; margin-right:8px; cursor:pointer; font-size:28px; color:#111; }
  .logo { display:flex; align-items:center; gap:10px; margin-left:8px; }
  .pt-badge{ width:48px; height:36px; background:#2f3542; color:white; border-radius:8px; display:flex; align-items:center; justify-content:center; font-weight:700; box-shadow:0 1px 0 rgba(255,255,255,0.06) inset; font-size:18px; }
  .title { font-size:22px; color:#2f3542; margin-left:10px; letter-spacing:0.2px; }

  #stage { position:absolute; left:0; right:0; top:64px; height: calc(100vh - 64px - 140px); display:flex; align-items:center; justify-content:center; background:#000; overflow:hidden; z-index:10; }

  .ground-shadow { position:absolute; width:300px; height:48px; left:50%; bottom:176px; transform:translateX(-50%); background: radial-gradient(ellipse at center, rgba(0,255,255,0.14) 0%, rgba(0,0,0,0) 70%); filter:blur(18px); z-index:15; pointer-events:none; }

  .bottom-nav { position:absolute; left:0;right:0; bottom:36px; display:flex; justify-content:center; gap:12px; z-index:50; }
  .btn { min-width:110px; padding:12px 18px; border-radius:6px; border:2px solid rgba(0,220,220,0.85); color:var(--teal); background:transparent; font-size:20px; letter-spacing:0.4px; box-sizing:border-box; cursor:pointer; text-align:center; backdrop-filter: blur(2px); }
  .btn.active{ background: rgba(0,200,200,0.18); color:#e6ffff; border-color: rgba(0,200,200,1); }

  /* Modal for element details */
  .modal{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.95);opacity:0;pointer-events:none;transition:0.25s;z-index:100;}
  .modal.active{opacity:1;pointer-events:auto;}
  .modal-content{background:#111;color:#0ff;padding:24px;border-radius:12px;max-width:400px;width:90%;text-align:center;}
  .modal-close{position:absolute;top:12px;right:12px;font-size:28px;color:#0ff;cursor:pointer;}
  .modal h2{margin:0 0 12px;font-size:32px;}
  .modal p{margin:4px 0;font-size:18px;}

  @media (max-width:420px){.btn{min-width:84px;padding:10px;font-size:18px}.top-wrapper{height:62px}#stage{top:62px;height:calc(100vh - 62px - 140px)}}
</style>
</head>
<body>

<div class="top-wrapper">
  <div class="back">←</div>
  <div class="logo">
    <div class="pt-badge">Pt</div>
    <div class="title">Periodic Table</div>
  </div>
</div>

<div id="stage"></div>
<div class="ground-shadow"></div>

<div class="bottom-nav">
  <button class="btn" id="btnTable">Table</button>
  <button class="btn active" id="btnSphere">Sphere</button>
  <button class="btn" id="btnHelix">Helix</button>
  <button class="btn" id="btnGrid">Grid</button>
</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <div class="modal-close" id="modalClose">×</div>
    <h2 id="elSymbol"></h2>
    <p id="elName"></p>
    <p id="elNumber"></p>
    <p id="elGroupPeriod"></p>
    <p id="elAppearance"></p>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
/* ---------- Setup ---------- */
const stage = document.getElementById('stage');
const renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
renderer.setPixelRatio(window.devicePixelRatio || 1);
renderer.setSize(window.innerWidth, stage.clientHeight);
stage.appendChild(renderer.domElement);

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(45, window.innerWidth / stage.clientHeight, 0.1, 10000);
camera.position.z = 1500;

scene.add(new THREE.AmbientLight(0x003333,0.6));
const point = new THREE.PointLight(0x00f0f0,1.6,4000);
point.position.set(0,0,1000);
scene.add(point);

const root = new THREE.Group();
scene.add(root);

/* ---------- Data (all 118) ---------- */
const ELEMENTS = [
  {symbol:"H",name:"Hydrogen",number:1,group:1,period:1,appearance:"Colorless gas"},
  {symbol:"He",name:"Helium",number:2,group:18,period:1,appearance:"Colorless gas"},
  {symbol:"Li",name:"Lithium",number:3,group:1,period:2,appearance:"Silvery-white metal"},
  {symbol:"Be",name:"Beryllium",number:4,group:2,period:2,appearance:"Gray-white metal"},
  {symbol:"B",name:"Boron",number:5,group:13,period:2,appearance:"Black-brown solid"},
  {symbol:"C",name:"Carbon",number:6,group:14,period:2,appearance:"Graphite black solid"},
  {symbol:"N",name:"Nitrogen",number:7,group:15,period:2,appearance:"Colorless gas"},
  {symbol:"O",name:"Oxygen",number:8,group:16,period:2,appearance:"Colorless gas"},
  {symbol:"F",name:"Fluorine",number:9,group:17,period:2,appearance:"Pale yellow gas"},
  {symbol:"Ne",name:"Neon",number:10,group:18,period:2,appearance:"Colorless gas"},
  {symbol:"Na",name:"Sodium",number:11,group:1,period:3,appearance:"Silvery-white metal"},
  {symbol:"Mg",name:"Magnesium",number:12,group:2,period:3,appearance:"Shiny gray solid"},
  {symbol:"Al",name:"Aluminium",number:13,group:13,period:3,appearance:"Silvery-white metal"},
  {symbol:"Si",name:"Silicon",number:14,group:14,period:3,appearance:"Dark gray solid"},
  {symbol:"P",name:"Phosphorus",number:15,group:15,period:3,appearance:"White/red/black solid"},
  {symbol:"S",name:"Sulfur",number:16,group:16,period:3,appearance:"Yellow solid"},
  {symbol:"Cl",name:"Chlorine",number:17,group:17,period:3,appearance:"Yellow-green gas"},
  {symbol:"Ar",name:"Argon",number:18,group:18,period:3,appearance:"Colorless gas"},
  {symbol:"K",name:"Potassium",number:19,group:1,period:4,appearance:"Silvery metal"},
  {symbol:"Ca",name:"Calcium",number:20,group:2,period:4,appearance:"Dull gray metal"},
  {symbol:"Sc",name:"Scandium",number:21,group:3,period:4,appearance:"Silvery-white metal"},
  {symbol:"Ti",name:"Titanium",number:22,group:4,period:4,appearance:"Silvery-gray metal"},
  {symbol:"V",name:"Vanadium",number:23,group:5,period:4,appearance:"Silvery-gray metal"},
  {symbol:"Cr",name:"Chromium",number:24,group:6,period:4,appearance:"Silvery metal"},
  {symbol:"Mn",name:"Manganese",number:25,group:7,period:4,appearance:"Silvery metal"},
  {symbol:"Fe",name:"Iron",number:26,group:8,period:4,appearance:"Metallic gray"},
  {symbol:"Co",name:"Cobalt",number:27,group:9,period:4,appearance:"Hard silvery metal"},
  {symbol:"Ni",name:"Nickel",number:28,group:10,period:4,appearance:"Silvery white metal"},
  {symbol:"Cu",name:"Copper",number:29,group:11,period:4,appearance:"Reddish metal"},
  {symbol:"Zn",name:"Zinc",number:30,group:12,period:4,appearance:"Bluish pale metal"},
  {symbol:"Ga",name:"Gallium",number:31,group:13,period:4,appearance:"Silvery metal"},
  {symbol:"Ge",name:"Germanium",number:32,group:14,period:4,appearance:"Gray-white solid"},
  {symbol:"As",name:"Arsenic",number:33,group:15,period:4,appearance:"Metallic gray solid"},
  {symbol:"Se",name:"Selenium",number:34,group:16,period:4,appearance:"Red/gray solid"},
  {symbol:"Br",name:"Bromine",number:35,group:17,period:4,appearance:"Reddish-brown liquid"},
  {symbol:"Kr",name:"Krypton",number:36,group:18,period:4,appearance:"Colorless gas"},
  {symbol:"Rb",name:"Rubidium",number:37,group:1,period:5,appearance:"Silvery-white metal"},
  {symbol:"Sr",name:"Strontium",number:38,group:2,period:5,appearance:"Silvery metal"},
  {symbol:"Y",name:"Yttrium",number:39,group:3,period:5,appearance:"Silvery-metallic"},
  {symbol:"Zr",name:"Zirconium",number:40,group:4,period:5,appearance:"Gray-white metal"},
  {symbol:"Nb",name:"Niobium",number:41,group:5,period:5,appearance:"Gray metal"},
  {symbol:"Mo",name:"Molybdenum",number:42,group:6,period:5,appearance:"Silvery metal"},
  {symbol:"Tc",name:"Technetium",number:43,group:7,period:5,appearance:"Silvery-gray metal"},
  {symbol:"Ru",name:"Ruthenium",number:44,group:8,period:5,appearance:"Silvery metal"},
  {symbol:"Rh",name:"Rhodium",number:45,group:9,period:5,appearance:"Silvery-white metal"},
  {symbol:"Pd",name:"Palladium",number:46,group:10,period:5,appearance:"Silvery-white metal"},
  {symbol:"Ag",name:"Silver",number:47,group:11,period:5,appearance:"Shiny white metal"},
  {symbol:"Cd",name:"Cadmium",number:48,group:12,period:5,appearance:"Silvery white metal"},
  {symbol:"In",name:"Indium",number:49,group:13,period:5,appearance:"Silvery metal"},
  {symbol:"Sn",name:"Tin",number:50,group:14,period:5,appearance:"Silvery metal"},
  {symbol:"Sb",name:"Antimony",number:51,group:15,period:5,appearance:"Silver-gray solid"},
  {symbol:"Te",name:"Tellurium",number:52,group:16,period:5,appearance:"Silvery metalloid"},
  {symbol:"I",name:"Iodine",number:53,group:17,period:5,appearance:"Shiny purple solid"},
  {symbol:"Xe",name:"Xenon",number:54,group:18,period:5,appearance:"Colorless gas"},
  {symbol:"Cs",name:"Cesium",number:55,group:1,period:6,appearance:"Pale gold metal"},
  {symbol:"Ba",name:"Barium",number:56,group:2,period:6,appearance:"Silvery-white metal"},
  {symbol:"La",name:"Lanthanum",number:57,group:3,period:6,appearance:"Silvery metal"},
  {symbol:"Ce",name:"Cerium",number:58,group:3,period:6,appearance:"Silvery metal"},
  {symbol:"Pr",name:"Praseodymium",number:59,group:3,period:6,appearance:"Metallic gray"},
  {symbol:"Nd",name:"Neodymium",number:60,group:3,period:6,appearance:"Silvery-white metal"},
  {symbol:"Pm",name:"Promethium",number:61,group:3,period:6,appearance:"Metallic"},
  {symbol:"Sm",name:"Samarium",number:62,group:3,period:6,appearance:"Silvery metal"},
  {symbol:"Eu",name:"Europium",number:63,group:3,period:6,appearance:"Silvery metal"},
  {symbol:"Gd",name:"Gadolinium",number:64,group:3,period:6,appearance:"Silvery metal"},
  {symbol:"Tb",name:"Terbium",number:65,group:3,period:6,appearance:"Silvery metal"},
  {symbol:"Dy",name:"Dysprosium",number:66,group:3,period:6,appearance:"Silvery metal"},
  {symbol:"Ho",name:"Holmium",number:67,group:3,period:6,appearance:"Silvery metal"},
  {symbol:"Er",name:"Erbium",number:68,group:3,period:6,appearance:"Silvery metal"},
  {symbol:"Tm",name:"Thulium",number:69,group:3,period:6,appearance:"Silvery-gray"},
  {symbol:"Yb",name:"Ytterbium",number:70,group:3,period:6,appearance:"Silvery metal"},
  {symbol:"Lu",name:"Lutetium",number:71,group:3,period:6,appearance:"Silvery white metal"},
  {symbol:"Hf",name:"Hafnium",number:72,group:4,period:6,appearance:"Silvery-gray"},
  {symbol:"Ta",name:"Tantalum",number:73,group:5,period:6,appearance:"Gray-blue metal"},
  {symbol:"W",name:"Tungsten",number:74,group:6,period:6,appearance:"Grayish metal"},
  {symbol:"Re",name:"Rhenium",number:75,group:7,period:6,appearance:"Silvery-white metal"},
  {symbol:"Os",name:"Osmium",number:76,group:8,period:6,appearance:"Blue-gray metal"},
  {symbol:"Ir",name:"Iridium",number:77,group:9,period:6,appearance:"Silvery-white metal"},
  {symbol:"Pt",name:"Platinum",number:78,group:10,period:6,appearance:"Silvery-white metal"},
  {symbol:"Au",name:"Gold",number:79,group:11,period:6,appearance:"Yellow metal"},
  {symbol:"Hg",name:"Mercury",number:80,group:12,period:6,appearance:"Silver liquid"},
  {symbol:"Tl",name:"Thallium",number:81,group:13,period:6,appearance:"Soft gray metal"},
  {symbol:"Pb",name:"Lead",number:82,group:14,period:6,appearance:"Bluish-gray metal"},
  {symbol:"Bi",name:"Bismuth",number:83,group:15,period:6,appearance:"Pinkish metal"},
  {symbol:"Po",name:"Polonium",number:84,group:16,period:6,appearance:"Silvery metal"},
  {symbol:"At",name:"Astatine",number:85,group:17,period:6,appearance:"Unknown, probably dark solid"},
  {symbol:"Rn",name:"Radon",number:86,group:18,period:6,appearance:"Colorless gas"},
  {symbol:"Fr",name:"Francium",number:87,group:1,period:7,appearance:"Unknown, likely metallic"},
  {symbol:"Ra",name:"Radium",number:88,group:2,period:7,appearance:"Silvery metal"},
  {symbol:"Ac",name:"Actinium",number:89,group:3,period:7,appearance:"Silvery metal"},
  {symbol:"Th",name:"Thorium",number:90,group:3,period:7,appearance:"Silvery"},
  {symbol:"Pa",name:"Protactinium",number:91,group:3,period:7,appearance:"Bright silvery metal"},
  {symbol:"U",name:"Uranium",number:92,group:3,period:7,appearance:"Silvery-gray metal"},
  {symbol:"Np",name:"Neptunium",number:93,group:3,period:7,appearance:"Silvery metal"},
  {symbol:"Pu",name:"Plutonium",number:94,group:3,period:7,appearance:"Silvery metal"},
  {symbol:"Am",name:"Americium",number:95,group:3,period:7,appearance:"Silvery metal"},
  {symbol:"Cm",name:"Curium",number:96,group:3,period:7,appearance:"Silvery metal"},
  {symbol:"Bk",name:"Berkelium",number:97,group:3,period:7,appearance:"Silvery"},
  {symbol:"Cf",name:"Californium",number:98,group:3,period:7,appearance:"Silvery"},
  {symbol:"Es",name:"Einsteinium",number:99,group:3,period:7,appearance:"Silvery"},
  {symbol:"Fm",name:"Fermium",number:100,group:3,period:7,appearance:"Unknown"},
  {symbol:"Md",name:"Mendelevium",number:101,group:3,period:7,appearance:"Unknown"},
  {symbol:"No",name:"Nobelium",number:102,group:3,period:7,appearance:"Unknown"},
  {symbol:"Lr",name:"Lawrencium",number:103,group:3,period:7,appearance:"Unknown"},
  {symbol:"Rf",name:"Rutherfordium",number:104,group:4,period:7,appearance:"Unknown"},
  {symbol:"Db",name:"Dubnium",number:105,group:5,period:7,appearance:"Unknown"},
  {symbol:"Sg",name:"Seaborgium",number:106,group:6,period:7,appearance:"Unknown"},
  {symbol:"Bh",name:"Bohrium",number:107,group:7,period:7,appearance:"Unknown"},
  {symbol:"Hs",name:"Hassium",number:108,group:8,period:7,appearance:"Unknown"},
  {symbol:"Mt",name:"Meitnerium",number:109,group:9,period:7,appearance:"Unknown"},
  {symbol:"Ds",name:"Darmstadtium",number:110,group:10,period:7,appearance:"Unknown"},
  {symbol:"Rg",name:"Roentgenium",number:111,group:11,period:7,appearance:"Unknown"},
  {symbol:"Cn",name:"Copernicium",number:112,group:12,period:7,appearance:"Unknown"},
  {symbol:"Nh",name:"Nihonium",number:113,group:13,period:7,appearance:"Unknown"},
  {symbol:"Fl",name:"Flerovium",number:114,group:14,period:7,appearance:"Unknown"},
  {symbol:"Mc",name:"Moscovium",number:115,group:15,period:7,appearance:"Unknown"},
  {symbol:"Lv",name:"Livermorium",number:116,group:16,period:7,appearance:"Unknown"},
  {symbol:"Ts",name:"Tennessine",number:117,group:17,period:7,appearance:"Unknown"},
  {symbol:"Og",name:"Oganesson",number:118,group:18,period:7,appearance:"Unknown"}
];

/* ---------- Glow sprite ---------- */
function makeGlow(){
  const c = document.createElement('canvas');
  c.width = c.height = 256;
  const ctx = c.getContext('2d');
  const grad = ctx.createRadialGradient(128,128,1,128,128,128);
  grad.addColorStop(0,'rgba(0,255,255,0.85)');
  grad.addColorStop(0.2,'rgba(0,255,255,0.45)');
  grad.addColorStop(0.5,'rgba(0,255,255,0.12)');
  grad.addColorStop(1,'rgba(0,0,0,0)');
  ctx.fillStyle = grad;
  ctx.fillRect(0,0,256,256);
  return new THREE.CanvasTexture(c);
}
const glowTex = makeGlow();

/* ---------- Tile creation (double-sided, never vanish) ---------- */
function createTile(el){
  const canvas = document.createElement('canvas');
  canvas.width = canvas.height = 256;
  const ctx = canvas.getContext('2d');

  // background rounded rect
  ctx.fillStyle = 'rgba(0,40,40,0.96)';
  roundRect(ctx,8,8,240,240,12);
  ctx.fill();

  // symbol
  ctx.fillStyle = '#bffcff';
  ctx.font = 'bold 78px Arial';
  ctx.textAlign = 'center';
  ctx.fillText(el.symbol,128,140);

  const tex = new THREE.CanvasTexture(canvas);
  tex.minFilter = THREE.LinearFilter;
  tex.needsUpdate = true;

  const mat = new THREE.MeshBasicMaterial({map:tex, transparent:true, side:THREE.DoubleSide});
  const plane = new THREE.Mesh(new THREE.PlaneGeometry(92,92), mat);
  plane.frustumCulled = false; // never vanish
  plane.userData = el;

  // Glow sprite behind
  const sprite = new THREE.Sprite(new THREE.SpriteMaterial({
    map: glowTex,
    color: 0x00ffff,
    blending: THREE.AdditiveBlending,
    transparent: true
  }));
  sprite.scale.set(120,120,1);
  plane.add(sprite);
  sprite.position.set(0,0,-1);

  return plane;
}
function roundRect(ctx,x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
}

/* ---------- Build tiles ---------- */
const objects = [];
const radius = 520;
ELEMENTS.forEach((el,i)=>{
  const tile = createTile(el);
  const phi = Math.acos(-1 + (2*i) / ELEMENTS.length);
  const theta = Math.sqrt(ELEMENTS.length * Math.PI) * phi;
  tile.position.x = radius * Math.cos(theta) * Math.sin(phi);
  tile.position.y = radius * Math.sin(theta) * Math.sin(phi);
  tile.position.z = radius * Math.cos(phi);
  root.add(tile);
  objects.push(tile);
});

/* ---------- Interaction: rotate (drag), zoom (wheel / right-drag / pinch) ---------- */
let isDown = false, startX = 0, startY = 0, lastVX = 0, lastVY = 0;
let isZoomDrag = false, zoomStartY = 0, zoomStartZ = camera.position.z;
let touchPrevDist = 0;

function down(e){
  const isTouch = !!e.touches;
  const button = isTouch ? 0 : (e.button !== undefined ? e.button : 0);
  if(!isTouch && button === 2){
    isZoomDrag = true;
    zoomStartY = e.touches ? e.touches[0].clientY : e.clientY;
    zoomStartZ = targetZoomZ;
    return;
  }
  isDown = true;
  startX = e.touches ? e.touches[0].clientX : e.clientX;
  startY = e.touches ? e.touches[0].clientY : e.clientY;
}
function move(e){
  const isTouch = !!e.touches;
  if(isTouch && e.touches.length === 2){
    const dx = e.touches[0].clientX - e.touches[1].clientX;
    const dy = e.touches[0].clientY - e.touches[1].clientY;
    const dist = Math.sqrt(dx*dx + dy*dy);
    if(touchPrevDist){
      const delta = dist - touchPrevDist;
      targetZoomZ -= delta * 1.2;
      clampTargetZoom();
    }
    touchPrevDist = dist;
    return;
  } else {
    touchPrevDist = 0;
  }

  if(isZoomDrag){
    const y = e.touches ? e.touches[0].clientY : e.clientY;
    const dy = y - zoomStartY;
    targetZoomZ = zoomStartZ + dy * 2.5;
    clampTargetZoom();
    return;
  }

  if(!isDown) return;
  const x = e.touches ? e.touches[0].clientX : e.clientX;
  const y = e.touches ? e.touches[0].clientY : e.clientY;
  const dx = x - startX, dy = y - startY;
  root.rotation.y += dx * 0.005;
  root.rotation.x += dy * 0.005;
  lastVX = dx * 0.005;
  lastVY = dy * 0.005;
  startX = x; startY = y;
}
function up(e){
  isDown = false;
  isZoomDrag = false;
  touchPrevDist = 0;
}

window.addEventListener('mousedown', down);
window.addEventListener('mousemove', move);
window.addEventListener('mouseup', up);
window.addEventListener('touchstart', (e)=>{ if(e.touches.length===2) touchPrevDist = null; down(e); }, {passive:false});
window.addEventListener('touchmove', move, {passive:false});
window.addEventListener('touchend', up, {passive:false});
window.addEventListener('contextmenu', (e)=> e.preventDefault());

// wheel zoom
let targetZoomZ = camera.position.z;
const MIN_Z = 600;
const MAX_Z = 3000;
function clampTargetZoom(){ targetZoomZ = Math.max(MIN_Z, Math.min(MAX_Z, targetZoomZ)); }
window.addEventListener('wheel', (e)=>{
  targetZoomZ += e.deltaY * 0.6;
  clampTargetZoom();
});

/* ---------- Layout transforms ---------- */
function toSphere(){
  objects.forEach((obj,i)=>{
    const phi = Math.acos(-1 + (2*i)/objects.length);
    const theta = Math.sqrt(objects.length * Math.PI) * phi;
    obj.userTarget = new THREE.Vector3(radius*Math.cos(theta)*Math.sin(phi), radius*Math.sin(theta)*Math.sin(phi), radius*Math.cos(phi));
  });
}
function toHelix(){
  objects.forEach((obj,i)=>{
    const a = i * 0.25;
    obj.userTarget = new THREE.Vector3(Math.sin(a)*520, -(i*18)+540, Math.cos(a)*520);
  });
}
function toGrid(){
  const cols = 14;
  objects.forEach((obj,i)=>{
    const col = i % cols;
    const row = Math.floor(i/cols);
    obj.userTarget = new THREE.Vector3((col-(cols/2))*110, (row-4)*-110, 0);
  });
}
toSphere();
objects.forEach((obj)=>{ if(!obj.userTarget) obj.userTarget = obj.position.clone(); });

/* ---------- Animation / render ---------- */
function render(){
  requestAnimationFrame(render);

  // drag inertia only (no automatic auto-rotation)
  root.rotation.y += lastVX * 0.02;
  root.rotation.x += lastVY * 0.02;
  lastVX *= 0.92;
  lastVY *= 0.92;

  // smooth camera zoom (lerp)
  camera.position.z += (targetZoomZ - camera.position.z) * 0.12;

  // move objects smoothly to targets and make them face camera (keeps cards straight)
  const worldCamPos = new THREE.Vector3();
  camera.getWorldPosition(worldCamPos);
  for(let i=0;i<objects.length;i++){
    const obj = objects[i];
    if(obj.userTarget){
      obj.position.lerp(obj.userTarget, 0.16);
    }
    // face camera
    obj.lookAt(worldCamPos);
    // keep upright: zero roll and pitch to keep tiles straight (only yaw relative to camera)
    obj.rotation.x = 0;
    obj.rotation.z = 0;
  }

  renderer.render(scene, camera);
}
render();

/* ---------- Buttons ---------- */
function setActive(btnId){
  document.querySelectorAll('.btn').forEach(b=>b.classList.remove('active'));
  const b = document.getElementById(btnId);
  if(b) b.classList.add('active');
}
document.getElementById('btnSphere').addEventListener('click', ()=>{
  toSphere(); setActive('btnSphere');
});
document.getElementById('btnHelix').addEventListener('click', ()=>{
  toHelix(); setActive('btnHelix');
});
document.getElementById('btnGrid').addEventListener('click', ()=>{
  toGrid(); setActive('btnGrid');
});
document.getElementById('btnTable').addEventListener('click', ()=>{
  const cols = 18;
  objects.forEach((obj,i)=>{
    const col = i % cols;
    const row = Math.floor(i/cols);
    obj.userTarget = new THREE.Vector3((col-(cols/2))*110, (row-3)*-110, 0);
  });
  setActive('btnTable');
});

/* ---------- Modal click handling ---------- */
const modal = document.getElementById('modal'), close = document.getElementById('modalClose');
const elSymbol = document.getElementById('elSymbol'), elName = document.getElementById('elName'),
      elNumber = document.getElementById('elNumber'), elGroupPeriod = document.getElementById('elGroupPeriod'),
      elAppearance = document.getElementById('elAppearance');

renderer.domElement.addEventListener('click', (e)=>{
  const mouse = new THREE.Vector2();
  const rect = renderer.domElement.getBoundingClientRect();
  mouse.x = ( (e.clientX - rect.left) / rect.width ) * 2 - 1;
  mouse.y = - ( (e.clientY - rect.top) / rect.height ) * 2 + 1;
  const raycaster = new THREE.Raycaster();
  raycaster.setFromCamera(mouse, camera);
  const hits = raycaster.intersectObjects(objects, true);
  if(hits.length){
    let obj = hits[0].object;
    // climb to parent which has userData (plane)
    while(obj && !obj.userData && obj.parent) obj = obj.parent;
    if(obj && obj.userData){
      const el = obj.userData;
      elSymbol.textContent = el.symbol;
      elName.textContent = el.name;
      elNumber.textContent = "Atomic Number: " + el.number;
      elGroupPeriod.textContent = "Group: " + el.group + " | Period: " + el.period;
      elAppearance.textContent = "Appearance: " + el.appearance;
      modal.classList.add('active');
    }
  }
});
close.addEventListener('click', ()=> modal.classList.remove('active'));

/* ---------- Resize ---------- */
window.addEventListener('resize', ()=>{
  renderer.setSize(window.innerWidth, stage.clientHeight);
  camera.aspect = window.innerWidth / stage.clientHeight;
  camera.updateProjectionMatrix();
});

/* ---------- Initialize zoom clamp ---------- */
targetZoomZ = camera.position.z;
clampTargetZoom();
</script>
</body>
</html>
